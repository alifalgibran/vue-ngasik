<!DOCTYPE html>
<html lang="en">
<head>
    <title>Admin - Ngaji Asik!</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">

    <script type="text/javascript" src="https://unpkg.com/vue@2.4.3/dist/vue.js"></script>
    <script type="text/javascript" src="https://unpkg.com/blueimp-gallery@2.27.0/js/blueimp-helper.js"></script>
    <script type="text/javascript" src="https://unpkg.com/blueimp-gallery@2.27.0/js/blueimp-gallery.js"></script>
    <script type="text/javascript" src="https://unpkg.com/blueimp-gallery@2.27.0/js/blueimp-gallery-fullscreen.js"></script>
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/blueimp-gallery@2.27.0/css/blueimp-gallery.min.css">
    <script type="text/javascript" src="vue-gallery.js"></script>

  <style>
  .image {
    float: left;
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center center;
    border: 1px solid #ebebeb;
    margin: 5px;
  }
  </style>
</head>
<body>
    <div id="app">
            <div class="card text-center">
                    <div class="card-header">
                      <ul class="nav nav-tabs card-header-tabs">
                        <li class="nav-item">
                          <a class="nav-link" href="#" @click="dafUsers()">daftar user</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" href="#" @click="dafReq()">daftar request</a>
                        </li>
                        <li class="nav-item">
                          <!-- <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a> -->
                          <a class="nav-link " href="#" @click="dafClass()">daftar kelas</a>
                        </li>
                      </ul>
                    </div>
                    <div class="card-body">
                        
                        <div class="contaner">
                        <div class="col-7" style="float: left;">
                            <component  :is="currentView" class="animated" keep-alive transition="custom-fade"></component>
                        </div>
                        <div class="col-5"  style="float: right;" >
                            <component :is="currentView2" class="animated" keep-alive transition="custom-fade"></component>
                        </div>
                        </div>
                        
                    </div>
                  </div>
        <!-- <ul>
            <li><a href="#" @click="dafUsers()">daftar user</a></li>
            <li><a href="#" @click="dafReq()">daftar request</a></li>
            <li><a href="#" @click="dafClass()">daftar kelas</a></li>
        </ul> -->
        
    </div>

    <template id='daftar-user-template'>
            <table class="table">
                    <thead>
                      <tr>
                        <th scope="col">No</th>
                        <th scope="col">Nama</th>
                        <th scope="col">Alamat</th>
                        <th scope="col">No. Telp</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr v-for="(halo,index) in fb">
                        <th>{{ index+1 }}</th>
                        <td>{{halo.name}}</td>
                        <td>{{halo.alasan}}</td>
                        <td>{{halo.noTelp}}</td>
                      </tr>
                    <!-- </tr>                     -->
                    </tbody>
                  </table>
    </template>

    <template id='daftar-user-template2'>
            <table class="table">
                    <thead>
                      <tr>
                        <th scope="col">Foto</th>
                      </tr>
                    </thead>
                    <tbody>
                    <tr v-for="(cek,index) in pp">
                        <td>
                            <a class="image-popup-no-margins" href="http://farm4.staticflickr.com/3721/9207329484_ba28755ec4_o.jpg">
                              <img src="http://farm4.staticflickr.com/3721/9207329484_ba28755ec4_o.jpg" width="107" height="75">
                            </a>
                            <img height="50" width="50" v-bind:src="cek"> 
                        </td>
                        <template>
                          <div>
                            <gallery :images="images" :index="index" @close="index = null"></gallery>
                            <div
                              class="image"
                              v-for="(image, imageIndex) in images"
                              :key="imageIndex"
                              @click="index = imageIndex"
                              :style="{ backgroundImage: 'url(' + image + ')', width: '300px', height: '200px' }"
                            ></div>
                          </div>
                        </template>                        
                    </tr>
                    </tbody>
                  </table>
            
  </template> 

    <template id="daftar-request-template">
            <table class="table">
                    <thead>
                      <tr>
                        <th scope="col">No</th>
                        <th scope="col">Nama</th>
                        <th scope="col">Alasan</th>
                        <th scope="col">Status</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr v-for="(halo2,index) in fb2">
                        <th>{{ index+1 }}</th>
                        <td>{{halo2.name}}</td>
                        <td>{{halo2.alasan}}</td>
                        <td>{{halo2.status}}</td>
                      </tr>
                      
                    <!-- </tr>                     -->
                    </tbody>
                  </table>
    </template>

    <template id='daftar-request-template2'>
            <table class="table">
                    <thead>
                      <tr>
                        <th scope="col">Foto</th>
                      </tr>
                    </thead>
                    <tbody>
                    <tr v-for="(cek,index) in pp2">
                        <td>
                            <gallery :images="images" :index="index" @close="index = null"></gallery>
                            <div
                              class="image"
                              v-for="image, imageIndex in images"
                              @click="index = imageIndex"
                              :style="{ backgroundImage: 'url(' + image.href + ')', width: '300px', height: '200px' }"
                            ></div>
                            <img height="50" width="50" v-bind:src="cek"> 
                        </td>
                    </tr>
                    <!-- </tr>                     -->
                    </tbody>
            </table>
            
  </template> 

    <template id="daftar-kelas-template">
            <ul>
                <li>we</li>
                <li>hihdi</li>
                <li>huasdhu</li>
            </ul>
        </template>
</body>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.0/firebase.js"></script>

<script>
    // $("a.grouped_elements").fancybox();
    var config =  {
        apiKey: "AIzaSyDewBM9i0kEwgpl-plCw2zBh17_qO_xRoo",
        authDomain: "ngasik-213d8.firebaseapp.com",
        databaseURL: "https://ngasik-213d8.firebaseio.com",
        projectId: "ngasik-213d8",
        storageBucket: "ngasik-213d8.appspot.com",
        messagingSenderId: "188332240090"
    };

   firebase.initializeApp(config);
   var dbUser = firebase.firestore();

   var pp = [];
   var datanyaForStorage = [];
   var datanya = [];

   var pp = [];
   var datanyaForStorageReq = [];
   var datanyaReq = [];
   
   //console.log(datanya)
   var urls = [];
   var urlsReq = [];
   Vue.component('daftar-user',{
       template: '#daftar-user-template',
       data: function(){
           return{
              fb: datanyaForStorage,
               pp: urls
           }
       }
   });

   Vue.component('daftar-user2',{
        template: '#daftar-user-template2',
        data: function(){
            return{
                fb: datanya,
                pp: urls,
                
            }
        }
   });

   Vue.component('daftar-request',{
       template: '#daftar-request-template',
        data: function(){
            return{
                fb2: datanyaReq,
                pp2: urlsReq
            }
        }
   });

   Vue.component('daftar-request2',{
       template: '#daftar-request-template2',
        data: function(){
            return{
                fb2: datanyaReq,
                pp2: urlsReq,
                images: [
                {
                  title: '400x400',
                  description: '400 x 400 White',
                  href: 'https://dummyimage.com/400/ffffff/000000',
                },
                {
                  title: '400x400',
                  description: '400 x 400 White',
                  href: 'https://dummyimage.com/400/ffffff/000000',
                },
                {
                  title: '400x400',
                  description: '400 x 400 Black',
                  href: 'https://dummyimage.com/400/000000/ffffff',
                },
                {
                  title: '400x400',
                  description: '400 x 400 Black',
                  href: 'https://dummyimage.com/400/000000/ffffff',
                },
              ],
        index: null
            }
        },
        components: {
          'gallery': VueGallery
        }
   });

   Vue.component('daftar-kelas',{
       template: '#daftar-kelas-template',
   });

//    Vue.transition('custom-fade',{
//        enterClass: 'bounceInDown',
//        leaveClass: 'fadeOutUp',
//    });

    var vm = new Vue({
            el: '#app',
            data:{
                hai: "",
                currentView: 'daftar-kelas',
                currentView2: ''
            },
            methods:{
                foto: function(foto = "sd"){
                  console.log(foto);
                },
                dafUsers(){
                    this.currentView = 'daftar-user'
                    this.currentView2 = 'daftar-user2'
                    dbUser.collection("users").get().then((querySnapshot) => {
                        querySnapshot.forEach((doc) => {
                        // console.log(`${doc.id} => ${doc.data()}`);
                            datanya.push(doc.data());
                            datanyaForStorage.push(doc.data());
                        });
                    });
                    
                    var i;
                    for(i = 0 ; i < datanya.length ; i++){
                        pp.push(datanya[i].profilePicturePath);
                        var storage = firebase.storage();
                        var storageRef = storage.ref();
                        console.log(datanya[i].profilePicturePath)
                        ///Qa0tYHrtaIZVdVUkBXQcwx4IRV83/profilePictures/096fee62-5989-3773-8833-9893c603c51e
                        var photoPath = storageRef.child(datanya[i].profilePicturePath);

                        if(photoPath != "" || photoPath != null){
                            photoPath.getDownloadURL().then(function(url){
                            //document.querySelector('img').src = url;
                            //console.log(url)
                            urls.push(url)
                            //console.log('urlnya dong' + datanya)
                        });
                        }
                        urls = [];
                        datanyaForStorage = [];
                    }
                    datanya = []
                    
                   // urls = [];
                },
                dafReq(){
                    this.currentView = 'daftar-request'
                    this.currentView2 = 'daftar-request2'

                    dbUser.collection("requestPengajar").get().then((querySnapshot) => {
                        querySnapshot.forEach((doc) => {
                        // console.log(`${doc.id} => ${doc.data()}`);
                            datanyaReq.push(doc.data());
                            datanyaForStorageReq.push(doc.data());
                        });
                    });
                    
                    var i;
                    for(i = 0 ; i < datanyaReq.length ; i++){
                        pp.push(datanyaReq[i].newestPhotoPath);
                        var storage = firebase.storage();
                        var storageRef = storage.ref();
                        console.log(datanyaReq[i].newestPhotoPath)
                        ///Qa0tYHrtaIZVdVUkBXQcwx4IRV83/profilePictures/096fee62-5989-3773-8833-9893c603c51e
                        var photoPath = storageRef.child(datanyaReq[i].newestPhotoPath);

                        if(photoPath != "" || photoPath != null){
                            photoPath.getDownloadURL().then(function(url){
                            //document.querySelector('img').src = url;
                            //console.log(url)
                            urlsReq.push(url)
                            console.log('urlnya dong' + url)
                        });
                        }
                        urlsReq = [];
                        datanyaForStorageReq = [];
                    }
                    datanyaReq = [];
                },
                dafClass(){
                    this.currentView = 'daftar-kelas'
                    this.currentView2 = ''
                }
            }
    });
    

</script>
</html>